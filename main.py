#!/usr/bin/env python
from fastapi import FastAPI # pip install "fastapi[standard]"
from fastapi.responses import FileResponse # TORUN: fastapi dev main.py

from PyPDFForm import FormWrapper # pip install PyPDFForm

from models import RecComplete # ./models.py

app = FastAPI(max_body_size=10485760)

@app.get("/")
async def read_root():
    filename = "EECS-GO-Standard-contract_V2.2.pdf"
    return {"root": "Hello World"} #FileResponse(filename)

@app.get("/rec_template")
async def write_recfile_template():
    filename = "EECS-GO-Standard-contract_V2.2.pdf"

    return FileResponse(path=filename, media_type='application/pdf', headers={'Content-Disposition': 'attachment; filename="EECS-GO-Standard-contract_V2.2.pdf"'})

@app.get("/rec_example")
async def write_recfile_example():
    filename = "EECS-GO-Standard-contract_V2.2.pdf"

    filled = FormWrapper(filename).fill(
    {
        "Group1": 0, #"Group1_type_integer_maximum_1",
        "Group2": 1, #"Group2_type_integer_maximum_1",
        "Tekstveld 272": "tk_272",
        "Tekstveld 273": "tk_273",
        "Tekstveld 336": "tk_336",
        "Tekstveld 337": "tk_337",
        "Tekstveld 338": "tk_338",
        "Tekstveld 339": "tk_339",
        "Tekstveld 340": "tk_340",
        "Tekstveld 341": "tk_341",
        "Tekstveld 342": "tk_342",
        "Tekstveld 343": "tk_343",
        "Tekstveld 344": "tk_344",
        "Tekstveld 345": "tk_345",
        "Tekstveld 346": "tk_346",
        "Tekstveld 347": "tk_347",
        "Tekstveld 367": "tk_367",
        "Tekstveld 370": "tk_370",
        "Tekstveld 437": "tk_437",
        "Tekstveld 438": "tk_438",
        "Tekstveld 439": "tk_439",
        "Tekstveld 440": "tk_440",
        "Tekstveld 441": "tk_441",
        "Tekstveld 442": "tk_442",
        "Tekstveld 443": "tk_443",
        "Tekstveld 444": "tk_444",
        "Tekstveld 445": "tk_445",
        "Tekstveld 446": "tk_446",
        "Tekstveld 447": "tk_447",
        "Tekstveld 448": "tk_448",
        "Tekstveld 449": "tk_449",
        "Tekstveld 450": "tk_450",
        "Tekstveld 451": "tk_451",
        "Tekstveld 452": "tk_452",
        "Tekstveld 453": "tk_453",
        "Tekstveld 454": "tk_454",
        "Tekstveld 455": "tk_455",
        "Tekstveld 475": "tk_475",
        "Tekstveld 476": "tk_476",
        "Tekstveld 52": "tk_52",
        "Tekstveld 720": "tk_720",
        "Tekstveld 723": "tk_723",
        "Tekstveld 724": "tk_724",
        "Tekstveld 8010": "tk_8010",
        "Tekstveld 8011": "tk_8011",
        "Tekstveld 8012": "tk_8012",
        "Tekstveld 8013": "tk_8013",
        "Tekstveld 8014": "tk_8014",
        "Tekstveld 8015": "tk_8015",
        "Tekstveld 811": "tk_811",
        "Tekstveld 812": "tk_812",
        "Tekstveld 813": "tk_813",
        "Tekstveld 814": "tk_814",
        "Tekstveld 815": "tk_815",
        "Tekstveld 816": "tk_816",
        "Tekstveld 817": "tk_817",
        "Tekstveld 818": "tk_818",
        "Tekstveld 819": "tk_819",
        "Tekstveld 820": "tk_820",
        "Tekstveld 821": "tk_821",
        "Tekstveld 822": "tk_822",
        "Tekstveld 823": "tk_823",
        "Tekstveld 824": "tk_824",
        "Tekstveld 825": "tk_825",
        "Tekstveld 826": "tk_826",
        "Tekstveld 827": "tk_827",
        "Tekstveld 828": "tk_828",
        "Tekstveld 829": "tk_829",
        "Tekstveld 830": "tk_830",
        "Tekstveld 831": "tk_831",
        "Tekstveld 832": "tk_832",
        "Tekstveld 833": "tk_833",
        "Tekstveld 834": "tk_834",
        "Tekstveld 835": "tk_835",
        "Tekstveld 836": "tk_836",
        "Tekstveld 837": "tk_837",
        "Tekstveld 838": "tk_838",
        "Tekstveld 839": "tk_839",
        "Tekstveld 840": "tk_840",
        "Tekstveld 841": "tk_841",
        "Tekstveld 842": "tk_842",
        "Tekstveld 843": "tk_843",
        "Tekstveld 844": "tk_844",
        "Tekstveld 845": "tk_845",
        "Tekstveld 846": "tk_846",
        "Tekstveld 847": "tk_847",
        "Tekstveld 848": "tk_848",
        "Tekstveld 849": "tk_849",
        "Tekstveld 850": "tk_850",
        "Tekstveld 851": "tk_851",
        "Tekstveld 852": "tk_852",
        "Tekstveld 853": "tk_853",
        "Tekstveld 854": "tk_854",
        "Tekstveld 855": "tk_855",
        "Tekstveld 856": "tk_856",
        "Tekstveld 857": "tk_857",
        "Tekstveld 858": "tk_858",
        "Tekstveld 859": "tk_859",
        "Tekstveld 860": "tk_860",
        "Tekstveld 861": "tk_861",
        "Tekstveld 862": "tk_862",
        "Tekstveld 863": "tk_863",
        "Tekstveld 864": "tk_864",
        "Tekstveld 865": "tk_865",
        "Tekstveld 866": "tk_866",
        "Tekstveld 867": "tk_867",
        "Tekstveld 868": "tk_868",
        "Tekstveld 869": "tk_869",
        "Tekstveld 870": "tk_870",
        "Tekstveld 871": "tk_871",
        "Tekstveld 872": "tk_872",
        "Tekstveld 873": "tk_873",
        "Tekstveld 874": "tk_874",
        "Tekstveld 875": "tk_875",
        "Tekstveld 876": "tk_876",
        "Tekstveld 877": "tk_877",
        "Tekstveld 878": "tk_878",
        "Tekstveld 879": "tk_879",
        "Tekstveld 880": "tk_880",
        "Tekstveld 881": "tk_881",
        "Tekstveld 882": "tk_882",
        "Tekstveld 883": "tk_883",
        "Tekstveld 884": "tk_884",
        "Tekstveld 885": "tk_885",
        "Tekstveld 886": "tk_886",
        "Tekstveld 887": "tk_887",
        "Tekstveld 888": "tk_888",
        "Tekstveld 889": "tk_889",
        "Tekstveld 890": "tk_890",
        "Tekstveld 891": "tk_891",
        "Tekstveld 892": "tk_892",
        "Tekstveld 893": "tk_893",
        "Tekstveld 894": "tk_894",
        "Tekstveld 895": "tk_895",
        "Tekstveld 896": "tk_896",
        "Tekstveld 897": "tk_897",
        "Tekstveld 898": "tk_898",
        "Tekstveld 899": "tk_899",
        "Tekstveld 900": "tk_900",
        "Tekstveld 901": "tk_901",
        "Tekstveld 9010": "tk_9010",
        "Tekstveld 9011": "tk_9011",
        "Tekstveld 902": "tk_902",
        "Tekstveld 903": "tk_903",
        "Tekstveld 904": "tk_904",
        "Tekstveld 905": "tk_905",
        "Tekstveld 906": "tk_906",
        "Tekstveld 908": "tk_908",
        "Tekstveld 909": "tk_909",
        "Tekstveld 910": "tk_910",
        "Tekstveld 911": "tk_911",
        "Tekstveld 912": "tk_912",
        "Tekstveld 913": "tk_913",
        "Tekstveld 914": "tk_914",
        "Tekstveld 915": "tk_915",
        "Tekstveld 916": "tk_916",
        "currency": "EUR"
    },
    adobe_mode=True, #
    )
    with open("output.pdf", "wb+") as output:
        output.write(filled.read())
    output_filename = "output.pdf"

    return FileResponse(path=output_filename, media_type='application/pdf', headers={'Content-Disposition': 'attachment; filename="output.pdf"'})


@app.put("/rec_complete")
async def write_recfile_complete(request: RecComplete):
    filename = "EECS-GO-Standard-contract_V2.2.pdf"

    filled = FormWrapper(filename).fill(
    {
        "currency": request.currency,
        "Group1": 1 if request.group1_int == "1" else 0,
        "Group2": 1 if request.group2_int == "1" else 0,
        "Tekstveld 272": request.tk_272,
        "Tekstveld 273": request.tk_273,
        "Tekstveld 336": request.tk_336,
        "Tekstveld 337": request.tk_337,
        "Tekstveld 338": request.tk_338,
        "Tekstveld 339": request.tk_339,
        "Tekstveld 340": request.tk_340,
        "Tekstveld 341": request.tk_341,
        "Tekstveld 342": request.tk_342,
        "Tekstveld 343": request.tk_343,
        "Tekstveld 344": request.tk_344,
        "Tekstveld 345": request.tk_345,
        "Tekstveld 346": request.tk_346,
        "Tekstveld 347": request.tk_347,
        "Tekstveld 367": request.tk_367,
        "Tekstveld 370": request.tk_370,
        "Tekstveld 437": request.tk_437,
        "Tekstveld 438": request.tk_438,
        "Tekstveld 439": request.tk_439,
        "Tekstveld 440": request.tk_440,
        "Tekstveld 441": request.tk_441,
        "Tekstveld 442": request.tk_442,
        "Tekstveld 443": request.tk_443,
        "Tekstveld 444": request.tk_444,
        "Tekstveld 445": request.tk_445,
        "Tekstveld 446": request.tk_446,
        "Tekstveld 447": request.tk_447,
        "Tekstveld 448": request.tk_448,
        "Tekstveld 449": request.tk_449,
        "Tekstveld 450": request.tk_450,
        "Tekstveld 451": request.tk_451,
        "Tekstveld 452": request.tk_452,
        "Tekstveld 453": request.tk_453,
        "Tekstveld 454": request.tk_454,
        "Tekstveld 455": request.tk_455,
        "Tekstveld 475": request.tk_475,
        "Tekstveld 476": request.tk_476,
        "Tekstveld 52": request.tk_52,
        "Tekstveld 720": request.tk_720,
        "Tekstveld 723": request.tk_723,
        "Tekstveld 724": request.tk_724,
        "Tekstveld 8010": request.tk_8010,
        "Tekstveld 8011": request.tk_8011,
        "Tekstveld 8012": request.tk_8012,
        "Tekstveld 8013": request.tk_8013,
        "Tekstveld 8014": request.tk_8014,
        "Tekstveld 8015": request.tk_8015,
        "Tekstveld 811": request.tk_811,
        "Tekstveld 812": request.tk_812,
        "Tekstveld 813": request.tk_813,
        "Tekstveld 814": request.tk_814,
        "Tekstveld 815": request.tk_815,
        "Tekstveld 816": request.tk_816,
        "Tekstveld 817": request.tk_817,
        "Tekstveld 818": request.tk_818,
        "Tekstveld 819": request.tk_819,
        "Tekstveld 820": request.tk_820,
        "Tekstveld 821": request.tk_821,
        "Tekstveld 822": request.tk_822,
        "Tekstveld 823": request.tk_823,
        "Tekstveld 824": request.tk_824,
        "Tekstveld 825": request.tk_825,
        "Tekstveld 826": request.tk_826,
        "Tekstveld 827": request.tk_827,
        "Tekstveld 828": request.tk_828,
        "Tekstveld 829": request.tk_829,
        "Tekstveld 830": request.tk_830,
        "Tekstveld 831": request.tk_831,
        "Tekstveld 832": request.tk_832,
        "Tekstveld 833": request.tk_833,
        "Tekstveld 834": request.tk_834,
        "Tekstveld 835": request.tk_835,
        "Tekstveld 836": request.tk_836,
        "Tekstveld 837": request.tk_837,
        "Tekstveld 838": request.tk_838,
        "Tekstveld 839": request.tk_839,
        "Tekstveld 840": request.tk_840,
        "Tekstveld 841": request.tk_841,
        "Tekstveld 842": request.tk_842,
        "Tekstveld 843": request.tk_843,
        "Tekstveld 844": request.tk_844,
        "Tekstveld 845": request.tk_845,
        "Tekstveld 846": request.tk_846,
        "Tekstveld 847": request.tk_847,
        "Tekstveld 848": request.tk_848,
        "Tekstveld 849": request.tk_849,
        "Tekstveld 850": request.tk_850,
        "Tekstveld 851": request.tk_851,
        "Tekstveld 852": request.tk_852,
        "Tekstveld 853": request.tk_853,
        "Tekstveld 854": request.tk_854,
        "Tekstveld 855": request.tk_855,
        "Tekstveld 856": request.tk_856,
        "Tekstveld 857": request.tk_857,
        "Tekstveld 858": request.tk_858,
        "Tekstveld 859": request.tk_859,
        "Tekstveld 860": request.tk_860,
        "Tekstveld 861": request.tk_861,
        "Tekstveld 862": request.tk_862,
        "Tekstveld 863": request.tk_863,
        "Tekstveld 864": request.tk_864,
        "Tekstveld 865": request.tk_865,
        "Tekstveld 866": request.tk_866,
        "Tekstveld 867": request.tk_867,
        "Tekstveld 868": request.tk_868,
        "Tekstveld 869": request.tk_869,
        "Tekstveld 870": request.tk_870,
        "Tekstveld 871": request.tk_871,
        "Tekstveld 872": request.tk_872,
        "Tekstveld 873": request.tk_873,
        "Tekstveld 874": request.tk_874,
        "Tekstveld 875": request.tk_875,
        "Tekstveld 876": request.tk_876,
        "Tekstveld 877": request.tk_877,
        "Tekstveld 878": request.tk_878,
        "Tekstveld 879": request.tk_879,
        "Tekstveld 880": request.tk_880,
        "Tekstveld 881": request.tk_881,
        "Tekstveld 882": request.tk_882,
        "Tekstveld 883": request.tk_883,
        "Tekstveld 884": request.tk_884,
        "Tekstveld 885": request.tk_885,
        "Tekstveld 886": request.tk_886,
        "Tekstveld 887": request.tk_887,
        "Tekstveld 888": request.tk_888,
        "Tekstveld 889": request.tk_889,
        "Tekstveld 890": request.tk_890,
        "Tekstveld 891": request.tk_891,
        "Tekstveld 892": request.tk_892,
        "Tekstveld 893": request.tk_893,
        "Tekstveld 894": request.tk_894,
        "Tekstveld 895": request.tk_895,
        "Tekstveld 896": request.tk_896,
        "Tekstveld 897": request.tk_897,
        "Tekstveld 898": request.tk_898,
        "Tekstveld 899": request.tk_899,
        "Tekstveld 900": request.tk_900,
        "Tekstveld 901": request.tk_901,
        "Tekstveld 9010": request.tk_9010,
        "Tekstveld 9011": request.tk_9011,
        "Tekstveld 902": request.tk_902,
        "Tekstveld 903": request.tk_903,
        "Tekstveld 904": request.tk_904,
        "Tekstveld 905": request.tk_905,
        "Tekstveld 906": request.tk_906,
        "Tekstveld 908": request.tk_908,
        "Tekstveld 909": request.tk_909,
        "Tekstveld 910": request.tk_910,
        "Tekstveld 911": request.tk_911,
        "Tekstveld 912": request.tk_912,
        "Tekstveld 913": request.tk_913,
        "Tekstveld 914": request.tk_914,
        "Tekstveld 915": request.tk_915,
        "Tekstveld 916": request.tk_916,
    },
    adobe_mode=True,
    )
    with open("output.pdf", "wb+") as output:
        output.write(filled.read())
    output_filename = "output.pdf"

    return FileResponse(path=output_filename, media_type='application/pdf', headers={'Content-Disposition': 'attachment; filename="output.pdf"'})

#if __name__ == '__main__':
#    multiprocessing.freeze_support() # For Windows support
#    uvicorn.run(app, host="0.0.0.0", port=8000, reload=False, workers=1)